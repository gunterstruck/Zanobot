const m=(e,n)=>n.some(t=>e instanceof t);let E,P;function x(){return E||(E=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function j(){return P||(P=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const w=new WeakMap,y=new WeakMap,l=new WeakMap;function k(e){const n=new Promise((t,r)=>{const o=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(u(e.result)),o()},s=()=>{r(e.error),o()};e.addEventListener("success",i),e.addEventListener("error",s)});return l.set(n,e),n}function A(e){if(w.has(e))return;const n=new Promise((t,r)=>{const o=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),o()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});w.set(e,n)}let B={get(e,n,t){if(e instanceof IDBTransaction){if(n==="done")return w.get(e);if(n==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return u(e[n])},set(e,n,t){return e[n]=t,!0},has(e,n){return e instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in e}};function p(e){B=e(B)}function v(e){return j().includes(e)?function(...n){return e.apply(b(this),n),u(this.request)}:function(...n){return u(e.apply(b(this),n))}}function O(e){return typeof e=="function"?v(e):(e instanceof IDBTransaction&&A(e),m(e,x())?new Proxy(e,B):e)}function u(e){if(e instanceof IDBRequest)return k(e);if(y.has(e))return y.get(e);const n=O(e);return n!==e&&(y.set(e,n),l.set(n,e)),n}const b=e=>l.get(e);function $(e,n,{blocked:t,upgrade:r,blocking:o,terminated:i}={}){const s=indexedDB.open(e,n),f=u(s);return r&&s.addEventListener("upgradeneeded",c=>{r(u(s.result),c.oldVersion,c.newVersion,u(s.transaction),c)}),t&&s.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),f.then(c=>{i&&c.addEventListener("close",()=>i()),o&&c.addEventListener("versionchange",a=>o(a.oldVersion,a.newVersion,a))}).catch(()=>{}),f}const T=["get","getKey","getAll","getAllKeys","count"],V=["put","add","delete","clear"],I=new Map;function M(e,n){if(!(e instanceof IDBDatabase&&!(n in e)&&typeof n=="string"))return;if(I.get(n))return I.get(n);const t=n.replace(/FromIndex$/,""),r=n!==t,o=V.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(o||T.includes(t)))return;const i=async function(s,...f){const c=this.transaction(s,o?"readwrite":"readonly");let a=c.store;return r&&(a=a.index(f.shift())),(await Promise.all([a[t](...f),o&&c.done]))[0]};return I.set(n,i),i}p(e=>({...e,get:(n,t,r)=>M(n,t)||e.get(n,t,r),has:(n,t)=>!!M(n,t)||e.has(n,t)}));const F=["continue","continuePrimaryKey","advance"],C={},g=new WeakMap,S=new WeakMap,K={get(e,n){if(!F.includes(n))return e[n];let t=C[n];return t||(t=C[n]=function(...r){g.set(this,S.get(this)[n](...r))}),t}};async function*W(...e){let n=this;if(n instanceof IDBCursor||(n=await n.openCursor(...e)),!n)return;n=n;const t=new Proxy(n,K);for(S.set(t,n),l.set(t,b(n));n;)yield t,n=await(g.get(t)||n.continue()),g.delete(t)}function L(e,n){return n===Symbol.asyncIterator&&m(e,[IDBIndex,IDBObjectStore,IDBCursor])||n==="iterate"&&m(e,[IDBIndex,IDBObjectStore])}p(e=>({...e,get(n,t,r){return L(n,t)?W:e.get(n,t,r)},has(n,t){return L(n,t)||e.has(n,t)}}));function d(e){return new Promise((n,t)=>{e.oncomplete=e.onsuccess=()=>n(e.result),e.onabort=e.onerror=()=>t(e.error)})}function R(e,n){let t;const r=()=>{if(t)return t;const o=indexedDB.open(e);return o.onupgradeneeded=()=>o.result.createObjectStore(n),t=d(o),t.then(i=>{i.onclose=()=>t=void 0},()=>{}),t};return(o,i)=>r().then(s=>i(s.transaction(n,o).objectStore(n)))}let D;function h(){return D||(D=R("keyval-store","keyval")),D}function N(e,n=h()){return n("readonly",t=>d(t.get(e)))}function z(e,n,t=h()){return t("readwrite",r=>(r.put(n,e),d(r.transaction)))}function H(e,n=h()){return n("readwrite",t=>(t.delete(e),d(t.transaction)))}function G(e,n){return e.openCursor().onsuccess=function(){this.result&&(n(this.result),this.result.continue())},d(e.transaction)}function J(e=h()){return e("readonly",n=>{if(n.getAllKeys)return d(n.getAllKeys());const t=[];return G(n,r=>t.push(r.key)).then(()=>t)})}export{H as d,N as g,J as k,$ as o,z as s};
//# sourceMappingURL=vendor-idb-DQ2Q1noU.js.map
