import{l as p}from"./data-CHglu3FA.js";function y(e){const t=e.length;if(!A(t))throw new Error(`FFT input length must be power of 2, got ${t}`);const n=Array.from(e,a=>({real:a,imag:0}));return x(n)}function x(e){const t=e.length,n=[...e],a=Math.log2(t);for(let r=0;r<t;r++){const o=z(r,a);o>r&&([n[r],n[o]]=[n[o],n[r]])}for(let r=2;r<=t;r*=2){const o=r/2,l=2*Math.PI/r;for(let m=0;m<t;m+=r)for(let c=0;c<o;c++){const s=-l*c,i={real:Math.cos(s),imag:Math.sin(s)},g=m+c,d=m+c+o,u=E(i,n[d]),f=n[g];n[g]=q(f,u),n[d]=v(f,u)}}return n}function z(e,t){let n=0;for(let a=0;a<t;a++)n=n<<1|e&1,e>>=1;return n}function M(e){const t=new Float64Array(e.length);for(let n=0;n<e.length;n++){const{real:a,imag:r}=e[n];t[n]=Math.hypot(a,r)}return t}function S(e){const t=e.length,n=new Float32Array(t);for(let a=0;a<t;a++){const r=.5*(1-Math.cos(2*Math.PI*a/(t-1)));n[a]=e[a]*r}return n}function R(e){const t=e.length,n=$(t);if(t===n)return e;const a=new Float32Array(n);return a.set(e),a}function q(e,t){return{real:e.real+t.real,imag:e.imag+t.imag}}function v(e,t){return{real:e.real-t.real,imag:e.imag-t.imag}}function E(e,t){return{real:e.real*t.real-e.imag*t.imag,imag:e.real*t.imag+e.imag*t.real}}function A(e){return e>0&&(e&e-1)===0}function $(e){return Math.pow(2,Math.ceil(Math.log2(e)))}const w={sampleRate:48e3,windowSize:.33,hopSize:.066,fftSize:2048,frequencyBins:512,frequencyRange:[0,24e3]};function P(e,t=w){if(!e.sampleRate||!isFinite(e.sampleRate)||e.sampleRate<=0||e.sampleRate>192e3)throw new Error(`Ungültige Sample Rate: ${e.sampleRate}Hz. Erwartet: 8000-192000Hz (typisch: 44100Hz oder 48000Hz)`);const a=t.sampleRate!==e.sampleRate||t.frequencyRange[1]!==e.sampleRate/2?{...t,sampleRate:e.sampleRate,frequencyRange:[0,e.sampleRate/2]}:t,[r,o]=a.frequencyRange;if(!isFinite(r)||!isFinite(o)||r<0||o<=r)throw new Error(`Invalid frequency range: [${r}, ${o}]Hz. Min must be >= 0, Max must be > Min, both must be finite.`);const l=a.sampleRate/2;if(o>l)throw new Error(`Frequency range max (${o}Hz) exceeds Nyquist frequency (${l}Hz) for sample rate ${a.sampleRate}Hz`);const m=a.windowSize,c=300;if(e.duration<m)throw new Error(`Audio buffer too short: ${e.duration.toFixed(2)}s (minimum: ${m.toFixed(2)}s)`);e.duration>c&&p.warn(`⚠️ Audio buffer very long (${e.duration.toFixed(1)}s), this may cause performance issues. Maximum recommended: ${c}s`);const s=C(e),i=D(s,e.sampleRate,a);if(i.length===0)throw new Error("Failed to extract any audio chunks - signal too short");return i.map(d=>F(d,a))}function O(e,t=w){const n={samples:e,duration:e.length/t.sampleRate};return F(n,t)}function F(e,t){let n=0;for(let h=0;h<e.samples.length;h++)n+=e.samples[h]*e.samples[h];const a=Math.sqrt(n/e.samples.length),r=b(e.samples);let o=0;for(let h=0;h<r.length;h++)o+=r[h]*r[h];o=Math.sqrt(o/r.length);let l=r;o<1e-6&&(p.warn(`⚠️ Standardization produced near-zero signal (RMS=${o.toExponential(2)}), using non-standardized signal instead`),l=e.samples);const m=S(l),c=R(m),s=y(c),i=M(s),g=i.slice(0,i.length/2),d=T(g,t.frequencyBins);let u=0;for(let h=0;h<d.length;h++)u+=d[h];if(u<1e-10)throw p.error(`❌ Feature extraction failed: Total energy = ${u.toExponential(2)} (degenerate signal)`),p.error("   This indicates the signal is too constant or silent."),p.error(`   RMS amplitude: ${a.toFixed(6)}`),new Error(`Feature extraction failed: Signal is too constant or silent (total energy = ${u.toExponential(2)}). This can happen with very stable noise sources. Please ensure the signal has sufficient variation.`);return{features:I(d),absoluteFeatures:d,bins:t.frequencyBins,frequencyRange:[0,t.sampleRate/2],rmsAmplitude:a}}function D(e,t,n){const a=Math.floor(n.windowSize*t),r=Math.floor(n.hopSize*t),o=[];let l=0;for(;l+a<=e.length;){const m=e.slice(l,l+a);o.push({samples:m,startTime:l/t,duration:n.windowSize,normalized:!1}),l+=r}return o}function b(e){const t=e.length;let n=0;for(let s=0;s<t;s++)n+=e[s];const a=n/t;let r=0;for(let s=0;s<t;s++){const i=e[s]-a;r+=i*i}const o=r/t,l=Math.sqrt(o);if(l<1e-6){p.warn(`⚠️ Signal too constant (stdDev=${l.toExponential(2)}), skipping standardization`);const s=new Float32Array(t);for(let i=0;i<t;i++)s[i]=e[i]-a;return s}const c=new Float32Array(t);for(let s=0;s<t;s++)c[s]=(e[s]-a)/l;return c}function T(e,t){const n=new Float64Array(t),a=Math.floor(e.length/t);for(let r=0;r<t;r++){const o=r*a,l=r===t-1?e.length:(r+1)*a;let m=0,c=0;for(let i=o;i<l;i++)m+=e[i]*e[i],c++;const s=c>0?m/c:0;n[r]=Math.sqrt(s)}return n}function I(e){const t=e.length;let n=0;for(let r=0;r<t;r++)n+=e[r];const a=new Float64Array(t);if(n>0)for(let r=0;r<t;r++)a[r]=e[r]/n;return a}function C(e){if(e.numberOfChannels===1)return e.getChannelData(0);const t=e.length,n=new Float32Array(t);for(let a=0;a<e.numberOfChannels;a++){const r=e.getChannelData(a);for(let o=0;o<t;o++)n[o]+=r[o]}for(let a=0;a<t;a++)n[a]/=e.numberOfChannels;return n}export{w as D,O as a,P as e};
//# sourceMappingURL=dsp-CDZtT2db.js.map
